# 描画オブジェクト管理 - Render object management

## 概要
三次元空間に配置されたオブジェクトを表現し描画するための一つの方法として、
「描画オブジェクト」について説明します。

ソースコード
- [サンプルプログラム（main.ts）](./main.ts)  
- [描画オブジェクトマネージャ（game_render_object_manager.ts）](../tips_core/game_render_object_manager.ts)

デモの実行

- [Live Demo](https://warotarock.github.io/ptw_tips/tips/render_object_management/)


### 描画オブジェクト
３次元空間に配置されたなんらかのオブジェクトを描画するには、描画対象の位置や回転、スケーリングといった、いくつかの情報が必要となります。また、それらの情報を保持するための変数や座標変換行列の変数が必要になります。

筆者は描画に必要な多くの変数をあらかじめ持ったオブジェクトを「描画オブジェクト」として共通して管理するようにしています。共通にすることで、次の項から説明するような機能をゲームシステムのどこからでも共通に利用可能になります。

なお、ソースコードを複数の別のゲームで共有しているのでなければ、描画オブジェクトに持たせる情報は開発するゲームの特性に合わせて積極的にカスタマイズしてよいと考えています。例えば描画に関するパラメータとして不透明度が必要であれば追加してよいでしょう。ただし、再利用時にかならず初期化するのを忘れないようにしましょう。


### オブジェクト・プーリング
描画オブジェクトの生成解放はオブジェクト・プーリングで行います。
つまり、必要に応じて生成解放するのではなく、特定のタイミング、例えばゲーム開始時などに一度にまとめて生成し、ゲーム中では何度も同じオブジェクトを再利用します。これにより実行時のメモリ確保を減らすとともに、ガーベージコレクションにより実行が不安定になることを防ぎます。


### レイヤー管理
ゲームでは多くの場合、描画処理は何回かの段階に分けて実行されます。例えば、まず背景をまとめて描画し、その後、前景をまとめて描画するというようなことをします。  レイヤーは、まとめて描画するオブジェクトを管理するための機能です。


### 奥行きソート
半透明オブジェクトを奥から順に描画するために、カメラから見た奥行きでソートする
ための機能です。ソートはレイヤー単位で行います。


### 描画オブジェクトマネージャ
ここまで説明した機能をクラスとしてまとめたものです。

ただし、サンプル用に描画オブジェクトの簡易な行列計算も含めてあります。
これは開発するゲームの特性に合わせてメインシステムに実装したほうが良いでしょう。


## 関連情報
- [モデルの描画](../basic_model_drawing/)
