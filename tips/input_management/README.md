# 入力管理 - Input management

## 概要
※作成途中です

複数種類のデバイス（キーボード、マウス、ゲームパッド）からの入力をゲームへの入力として統合するしくみについての説明とサンプルプログラムです。なお、ここでは基本的にゲーム向けを想定し、フォームなどのGUIは想定しません。

ソースコード
- [サンプルプログラム（main.ts）](./main.ts)
- [入力マネージャ（input.ts）](../tips_core/input.ts)
- [マウス（input_mouse.ts）](./input_mouse.ts)
- [キーボード（input_keyborad.ts）](./input_keyborad.ts)
- [ゲームパッド（input_gamepad.ts）](./input_gamepad.ts)


## 入力管理
ユーザからの入力をゲームに伝えるためには、キーボード、マウスといった入力デバイスからAPIを通じて情報を取得する必要があります。また、複数のデバイスが同時に利用可能である場合には、デバイスごとや入力の種類ごとに優先順位をつけてユーザからの入力をゲームに伝える必要があります。

ここで紹介するプログラムは、キーボード、マウス、ゲームパッドからの入力を統合して扱うことができるマネージャと、簡単なゲームを想定した入力形式（移動ボタン、攻撃ボタン、防御ボタンなど）に統合して利用するサンプルです。

以下はその特徴です。
- 複数種類のデバイスからの入力を統合
- マネージャは変更せずにデバイスの追加が可能
- ボタンの割り当てをカスタマイズ可能


なお、各種の単語は概ね以下のような意味で使っています。

|単語|説明|
|:-----------------|:-------------------------|
|デバイス|キーボード、マウス、ゲームパッドなどの入力デバイス|
|入力コントロール|キーボードのボタン、マウスの位置、ゲームパッドのスティックといった入力デバイスのもつ入力単位の総称  フォームコントロールのようなニュアンス|
|入力管理|ここでは特にゲーム向けに整理された方法で入力をうまく扱うこと|
|入力マネージャ|入力管理を実装したもの|


## プログラムの構成
![プログラムの構成](input_mamager_fig001.png)


## デバイスクラス
キーボード、マウス、ゲームパッドといったデバイスからＡＰＩを通じて入力を受け取るクラスです。

デバイスクラスはIInputDeviceインターフェースを実装したクラスです。マネージャはIInputDeviceを実装したクラスを受け取り決められた関数を呼び出すことで、様々なデバイスを統合して扱うことが可能になります。

デバイスの行う処理は実装しだいですが、最終的には、受け取った入力は次から説明する各種の入力コントロールに集約します。


## ボタン入力コントロールクラス

ButtonInputControl

サポートする入力値
- 押下状態を検出（解放状態、解放になった瞬間、押下になった瞬間、押下状態）
- ダブルクリック状態（解放状態、ダブルクリックになった瞬間）を検出

ボタン入力の状態を扱うコントロールです。想定しているのは、キーボードからのキー入力、マウスのボタン入力、ゲームパッドのボタン入力です。これらの入力は一般的にボタンの押下状態として考えることができます。また、マウスボタンの操作方法としてダブルクリックもあります。


## アクシズ入力(アナログ入力)コントロールクラス

AxisInputControl

サポートする入力値
- X値（浮動小数）
- Y値（浮動小数）

アナログ入力の状態を扱うコントロールです。想定しているのは、ゲームパッドのアナログスティックによる入力です。アナログスティックの入力はスティックの傾きを表すX, Yの２値としてゲームパッドから取得されます。


## ポインタ入力コントロールクラス

PointingInputControl

サポートする入力値
- X座標（浮動小数）
- Y座標（浮動小数）

位置情報を扱うコントロールです。想定しているのは、マウスの位置やタッチ入力のタッチ位置です。これはX座標, Y座標として取得されます。


## マッピング
複数の入力元からの入力を統合し割り当てます（マッピング）。一つのデバイスから一つのボタンに複数の入力を割り当てることも可能です。

Jsonを受け取ってカスタマイズ可能です。その場合のマッピングの優先順は登録順です。先に登録されたデバイスのコントロールが優先され、同じデバイス内であれば先に登録されたコントロールが優先されます。


## マネージャ
デバイスを実行し、マッピング処理を行います。


## 関連情報
特になし
